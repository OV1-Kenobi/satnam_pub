<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Satnam NFC Provisioning Guide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Guía de inicio rápido para el usuario final para aprovisionar de forma segura NTAG424 NFC Physical MFA para Satnam" />
  <style>
    :root{--bg:#fff;--fg:#111;--muted:#555;--accent:#0b74de;--warn:#b00020;--ok:#0a7f3f}
    *{box-sizing:border-box} body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;color:var(--fg);background:var(--bg);}
    header{padding:24px;border-bottom:1px solid #eee}
    h1{margin:0 0 4px;font-size:26px} h2{margin:24px 0 8px;font-size:20px} h3{margin:18px 0 6px;font-size:16px}
    p{line-height:1.55;margin:8px 0} ul{margin:8px 0 8px 20px} li{margin:6px 0}
    .container{max-width:960px;margin:0 auto;padding:24px}
    .grid{display:grid;gap:16px} .two{grid-template-columns:1fr 1fr} .three{grid-template-columns:repeat(3,1fr)}
    .card{border:1px solid #eee;border-radius:8px;padding:16px}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eee;color:#333;font-size:12px;margin-right:6px}
    .callout{border-left:4px solid var(--accent);padding:12px 12px 12px 16px;background:#f8fbff}
    .danger{border-left-color:var(--warn);background:#fff7f8}
    .ok{border-left-color:var(--ok);background:#f7fff9}
    code,kbd{background:#f2f2f2;padding:2px 6px;border-radius:4px}
    .steps ol{margin:8px 0 8px 20px} .steps li{margin:8px 0}
    .diagram{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#fafafa;border:1px solid #eee;border-radius:6px;padding:12px;white-space:pre;overflow:auto}
    .lang-nav{text-align:center;margin:16px 0;padding:12px;background:#f0f0f0;border-radius:6px}
    .lang-nav a{margin:0 8px;color:var(--accent);text-decoration:none;font-weight:500}
    .lang-nav a:hover{text-decoration:underline}
    @media print{header .lang-nav,.no-print{display:none}.container{padding:0} a[href]::after{content:" (" attr(href) ")";font-size:10px;color:#666}}
  </style>
</head>
<body>
  <header>
    <h1>Satnam NFC Provisioning Guide</h1>
    <div style="color:var(--muted);font-size:16px;margin-top:8px">NTAG424 NFC Physical MFA • Privacidad primero • Conocimiento cero</div>
    <div class="lang-nav no-print">
      <strong>Idiomas:</strong>
      <a href="satnam-nfc-provisioning-guide.html">English</a>
      <a href="satnam-nfc-provisioning-guide-es.html">Español</a>
      <a href="satnam-nfc-provisioning-guide-de.html">Deutsch</a>
      <a href="satnam-nfc-provisioning-guide-ja.html">日本語</a>
    </div>
  </header>
  <div class="container">

    <div class="callout ok">
      <strong>Objetivo</strong>: Aprovisione su etiqueta NTAG424 de forma segura para Satnam NFC Physical MFA sin necesidad de un puente de hardware separado. Toda la verificación se realiza mediante las funciones de Netlify de Satnam utilizando comprobaciones locales de SUN/CMAC.
      <br/><br/>
      <strong>Estado</strong>: ✅ Listo para producción (Fase 6 completada • 74 pruebas aprobadas • 100% de cobertura)
    </div>

    <h2>1) Aprovisionamiento con Boltcard (solo Android)</h2>
    <div class="card">
      <div class="badge">Ruta única</div>
      <h3>Android (Aplicación de programación Boltcard)</h3>
      <ul>
        <li>Teléfono Android con NFC</li>
        <li>Aplicación: Aplicación de programación Boltcard NFC</li>
        <li>Ruta más rápida y oficialmente compatible</li>
      </ul>
      <p><strong>Descargar</strong>:</p>
      <ul>
        <li>Lanzamientos (APK): https://github.com/boltcard/bolt-nfc-android-app/releases</li>
        <li>Play Store: https://play.google.com/store/apps/details?id=com.lightningnfcapp</li>
      </ul>
    </div>

    <div class="callout" style="margin-top:12px">
      <strong>Siguiente paso:</strong> Después de aprovisionar su etiqueta de nombre, regrese a la página de inicio de Satnam y haga clic en <em>"Register/Signin Your Name Tag"</em> para completar el registro/autenticación.
      <br/>
      <strong>Referencia:</strong> Guía de configuración externa de Boltcard: <a href="https://ereignishorizont.xyz/en/boltcard_en/" target="_blank" rel="noopener noreferrer">ereignishorizont.xyz/en/boltcard_en/</a>
    </div>

    <div class="callout" style="margin-top:12px">
      <strong>Usuarios de iOS</strong>: Pida prestado un dispositivo Android o visite una estación de aprovisionamiento comunitaria para programar su etiqueta. Después de la programación, su etiqueta funciona con iOS para tocar/verificar.
    </div>

    <div class="callout danger" style="margin-top:12px">
      <strong>Crítico de seguridad</strong>: Nunca comparta su blob de aprovisionamiento (K0/K1/K2, configuración de SDM) fuera de su dispositivo seguro. Guárdelo en un administrador de contraseñas. Si pierde las claves después de cambiarlas en la etiqueta, no podrá reprogramar esa etiqueta.
    </div>

    <h2>2) Obtenga su blob de aprovisionamiento de Satnam</h2>
    <p>En Satnam: Security → NFC Physical MFA → "Provision new tag". Esto llama a <code>/nfc-unified/initialize</code> y proporciona un blob JSON (solo del lado del cliente) con:</p>
    <ul>
      <li><code>url_base</code> — la URL NDEF a escribir (p. ej., https://www.satnam.pub/nfc/scan)</li>
      <li><code>k0</code>, <code>k1</code>, <code>k2</code> — claves AES (hex)</li>
      <li><code>sdm</code> — habilitar SUN/SDM + desplazamientos (inserción PICC/CMAC)</li>
    </ul>

    <h2>3) Pasos de aprovisionamiento (Boltcard Android)</h2>
    <div class="steps card">
      <ol>
        <li>Instale la aplicación Boltcard (APK/Play) y habilite NFC.</li>
        <li>Abra <em>Key change</em> → aplique <code>K0/K1/K2</code> exactamente como lo proporciona Satnam (del blob de aprovisionamiento).</li>
        <li>Habilite <strong>SDM/SUN</strong> y establezca desplazamientos según el blob para que <code>PICC</code> (UID) y <code>CMAC</code> se agreguen a la URL.</li>
        <li>Establezca la URL NDEF en su base: <code>https://www.satnam.pub/t/&lt;duid&gt;</code>. Los parámetros de SDM se agregarán al leer como <code>?sdm=...&amp;u=...</code>.</li>
        <li>Opcional: Habilite la aleatorización de UID para privacidad (irreversible).</li>
        <li>Mantenga la etiqueta quieta en el teléfono hasta que la programación sea exitosa.</li>
      </ol>
    </div>

    <h2>4) Verifique su etiqueta</h2>
    <ul>
      <li><strong>Rápido</strong>: Toque con cualquier teléfono NFC. La URL abierta debe incluir parámetros de SDM dinámicos (p. ej., CMAC/PICC).</li>
      <li><strong>Satnam de extremo a extremo</strong>: Toque → la aplicación abre Satnam → el frontend llama a <code>/nfc-unified/verify</code> con campos de SDM → respuesta exitosa.</li>
      <li><strong>Bajo nivel</strong>: Use TagXplorer para confirmar claves, habilitación de SDM y registro de URL NDEF.</li>
    </ul>

    <h2>5) Cómo se integra (de un vistazo)</h2>
    <div class="diagram">El usuario toca → El teléfono abre url_base NDEF
   → El frontend captura parámetros de SDM (PICC/CMAC)
   → Función de Netlify /nfc-unified/verify
   → Verificación de SUN/CMAC a través de la función de Netlify (puente de hardware forzado cuando se configura)
   → Éxito de sesión/autenticación
   → (Opcional) Las tarjetas Boltcard de LNbits se utilizan solo para metadatos de billetera/registro
    </div>

    <h2>6) Solución de problemas</h2>
    <ul>
      <li><strong>Escritura fallida / Etiqueta movida</strong>: Mantenga la etiqueta completamente quieta; reintentar. Asegúrese de que la bobina NFC del teléfono se alinee con la antena de la etiqueta.</li>
      <li><strong>CMAC falta en la URL</strong>: SDM no habilitado u desplazamientos incorrectos. Vuelva a aplicar la configuración de SDM por blob.</li>
      <li><strong>No se puede reprogramar</strong>: Claves cambiadas pero perdidas. La etiqueta no se puede reprovisionar sin las claves correctas.</li>
      <li><strong>Problemas del lector de escritorio</strong>: Use PN532 o un lector NXP con soporte NTAG424; evite ACR122U más antiguo.</li>
      <li><strong>Errores de Android</strong>: Reinstale la aplicación; asegúrese de que NFC esté habilitado en el dispositivo y que ninguna otra aplicación NFC interfiera.</li>
    </ul>

    <h2>7) Mejores prácticas</h2>
    <ul>
      <li>Aprovisione en un entorno controlado (sin dispositivos NFC desconocidos cerca).</li>
      <li>Guarde el blob de aprovisionamiento en un administrador de contraseñas; nunca lo envíe por correo electrónico o chat.</li>
      <li>Pruebe primero con una etiqueta de repuesto; registre registros de éxito de <code>/nfc-unified/verify</code>.</li>
    </ul>

    <h2>8) Recursos adicionales</h2>
    <div class="card">
      <p><strong>Documentación y herramientas</strong></p>
      <ul>
        <li><a href="/docs/NFC_TROUBLESHOOTING.md" target="_blank" rel="noopener noreferrer">Guía de solución de problemas</a> - Problemas comunes y soluciones</li>
        <li><a href="/docs/NFC_API_ENDPOINTS.md" target="_blank" rel="noopener noreferrer">Referencia de API</a> - Documentación completa del punto final</li>
        <li><a href="/docs/NFC_SECURITY_ARCHITECTURE.md" target="_blank" rel="noopener noreferrer">Arquitectura de seguridad</a> - Estándares de cifrado y políticas de RLS</li>
        <li><a href="/docs/NFC_FEATURE_FLAGS.md" target="_blank" rel="noopener noreferrer">Guía de banderas de características</a> - Configuración y configuración del entorno</li>
        <li><a href="/docs/ntag424-blob-viewer.html" target="_blank" rel="noopener noreferrer">Herramienta Blob Viewer</a> - Inspeccione el contenido del archivo de tarjeta</li>
      </ul>
    </div>

    <div class="callout ok" style="margin-top:12px">
      <strong>Estado de producción</strong>: Esta guía refleja la finalización de la Fase 6 con 74 pruebas aprobadas (36 unidades + 19 integración + 19 E2E). Todos los estándares de seguridad verificados. Arquitectura de conocimiento cero confirmada. Listo para la implementación en producción.
    </div>

    <p class="no-print" style="margin-top:24px;color:var(--muted)">Consejo: Use su navegador Imprimir → "Guardar como PDF" para exportar esta guía.</p>
  </div>
</body>
</html>
