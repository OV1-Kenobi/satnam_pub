<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Satnam NFC Provisioning Guide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Benutzerhandbuch zur sicheren Bereitstellung von NTAG424 NFC Physical MFA für Satnam" />
  <style>
    :root{--bg:#fff;--fg:#111;--muted:#555;--accent:#0b74de;--warn:#b00020;--ok:#0a7f3f}
    *{box-sizing:border-box} body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;color:var(--fg);background:var(--bg);}
    header{padding:24px;border-bottom:1px solid #eee}
    h1{margin:0 0 4px;font-size:26px} h2{margin:24px 0 8px;font-size:20px} h3{margin:18px 0 6px;font-size:16px}
    p{line-height:1.55;margin:8px 0} ul{margin:8px 0 8px 20px} li{margin:6px 0}
    .container{max-width:960px;margin:0 auto;padding:24px}
    .grid{display:grid;gap:16px} .two{grid-template-columns:1fr 1fr} .three{grid-template-columns:repeat(3,1fr)}
    .card{border:1px solid #eee;border-radius:8px;padding:16px}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eee;color:#333;font-size:12px;margin-right:6px}
    .callout{border-left:4px solid var(--accent);padding:12px 12px 12px 16px;background:#f8fbff}
    .danger{border-left-color:var(--warn);background:#fff7f8}
    .ok{border-left-color:var(--ok);background:#f7fff9}
    code,kbd{background:#f2f2f2;padding:2px 6px;border-radius:4px}
    .steps ol{margin:8px 0 8px 20px} .steps li{margin:8px 0}
    .diagram{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#fafafa;border:1px solid #eee;border-radius:6px;padding:12px;white-space:pre;overflow:auto}
    .lang-nav{text-align:center;margin:16px 0;padding:12px;background:#f0f0f0;border-radius:6px}
    .lang-nav a{margin:0 8px;color:var(--accent);text-decoration:none;font-weight:500}
    .lang-nav a:hover{text-decoration:underline}
    @media print{header .lang-nav,.no-print{display:none}.container{padding:0} a[href]::after{content:" (" attr(href) ")";font-size:10px;color:#666}}
  </style>
</head>
<body>
  <header>
    <h1>Satnam NFC Provisioning Guide</h1>
    <div style="color:var(--muted);font-size:16px;margin-top:8px">NTAG424 NFC Physical MFA • Datenschutz-orientiert • Zero-Knowledge</div>
    <div class="lang-nav no-print">
      <strong>Sprachen:</strong>
      <a href="satnam-nfc-provisioning-guide.html">English</a>
      <a href="satnam-nfc-provisioning-guide-es.html">Español</a>
      <a href="satnam-nfc-provisioning-guide-de.html">Deutsch</a>
      <a href="satnam-nfc-provisioning-guide-ja.html">日本語</a>
    </div>
  </header>
  <div class="container">

    <div class="callout ok">
      <strong>Ziel</strong>: Stellen Sie Ihren NTAG424-Tag sicher für Satnam NFC Physical MFA bereit, ohne eine separate Hardware-Bridge zu benötigen. Alle Verifizierungen werden von Satnams Netlify-Funktionen mit lokalen SUN/CMAC-Checks durchgeführt.
      <br/><br/>
      <strong>Status</strong>: ✅ Produktionsbereit (Phase 6 abgeschlossen • 74 Tests bestanden • 100% Abdeckung)
    </div>

    <h2>1) Bereitstellung mit Boltcard (nur Android)</h2>
    <div class="card">
      <div class="badge">Einzelner Pfad</div>
      <h3>Android (Boltcard Programming App)</h3>
      <ul>
        <li>Android-Telefon mit NFC</li>
        <li>App: Boltcard NFC Programming App</li>
        <li>Schnellster und offiziell unterstützter Weg</li>
      </ul>
      <p><strong>Download</strong>:</p>
      <ul>
        <li>Releases (APK): https://github.com/boltcard/bolt-nfc-android-app/releases</li>
        <li>Play Store: https://play.google.com/store/apps/details?id=com.lightningnfcapp</li>
      </ul>
    </div>

    <div class="callout" style="margin-top:12px">
      <strong>Nächster Schritt:</strong> Nach der Bereitstellung Ihres Name Tag kehren Sie zur Satnam-Startseite zurück und klicken auf <em>"Register/Signin Your Name Tag"</em>, um die Registrierung/Authentifizierung abzuschließen.
      <br/>
      <strong>Referenz:</strong> Externes Boltcard-Setup-Handbuch: <a href="https://ereignishorizont.xyz/en/boltcard_en/" target="_blank" rel="noopener noreferrer">ereignishorizont.xyz/en/boltcard_en/</a>
    </div>

    <div class="callout" style="margin-top:12px">
      <strong>iOS-Benutzer</strong>: Leihen Sie sich ein Android-Gerät aus oder besuchen Sie eine Community-Bereitstellungsstation, um Ihren Tag zu programmieren. Nach der Programmierung funktioniert Ihr Tag mit iOS zum Tippen/Verifizieren.
    </div>

    <div class="callout danger" style="margin-top:12px">
      <strong>Sicherheitskritisch</strong>: Geben Sie Ihren Provisioning-Blob (K0/K1/K2, SDM-Konfiguration) niemals außerhalb Ihres sicheren Geräts frei. Speichern Sie ihn in einem Passwort-Manager. Wenn Sie die Schlüssel nach dem Ändern auf dem Tag verlieren, können Sie diesen Tag nicht neu programmieren.
    </div>

    <h2>2) Provisioning-Blob von Satnam abrufen</h2>
    <p>In Satnam: Security → NFC Physical MFA → "Provision new tag". Dies ruft <code>/nfc-unified/initialize</code> auf und stellt einen JSON-Blob (nur Client-seitig) mit folgenden Inhalten bereit:</p>
    <ul>
      <li><code>url_base</code> — die zu schreibende NDEF-URL (z.B. https://www.satnam.pub/nfc/scan)</li>
      <li><code>k0</code>, <code>k1</code>, <code>k2</code> — AES-Schlüssel (hex)</li>
      <li><code>sdm</code> — SUN/SDM aktivieren + Offsets (PICC/CMAC-Einfügung)</li>
    </ul>

    <h2>3) Provisioning-Schritte (Boltcard Android)</h2>
    <div class="steps card">
      <ol>
        <li>Installieren Sie die Boltcard-App (APK/Play) und aktivieren Sie NFC.</li>
        <li>Öffnen Sie <em>Key change</em> → wenden Sie <code>K0/K1/K2</code> genau wie von Satnam bereitgestellt an (aus dem Provisioning-Blob).</li>
        <li>Aktivieren Sie <strong>SDM/SUN</strong> und stellen Sie Offsets pro Blob ein, damit <code>PICC</code> (UID) und <code>CMAC</code> an die URL angehängt werden.</li>
        <li>Stellen Sie die NDEF-URL auf Ihre Basis ein: <code>https://www.satnam.pub/t/&lt;duid&gt;</code>. Die SDM-Parameter werden beim Lesen als <code>?sdm=...&amp;u=...</code> angehängt.</li>
        <li>Optional: Aktivieren Sie UID-Randomisierung für Datenschutz (irreversibel).</li>
        <li>Halten Sie den Tag während der Programmierung still auf dem Telefon.</li>
      </ol>
    </div>

    <h2>4) Verifizieren Sie Ihren Tag</h2>
    <ul>
      <li><strong>Schnell</strong>: Tippen Sie mit einem beliebigen NFC-Telefon. Die geöffnete URL sollte dynamische SDM-Parameter enthalten (z.B. CMAC/PICC).</li>
      <li><strong>Satnam End-to-End</strong>: Tippen → App öffnet Satnam → Frontend ruft <code>/nfc-unified/verify</code> mit SDM-Feldern auf → Erfolgreiches Ergebnis.</li>
      <li><strong>Low-Level</strong>: Verwenden Sie TagXplorer, um Schlüssel, SDM-Aktivierung und NDEF-URL-Datensatz zu bestätigen.</li>
    </ul>

    <h2>5) Wie es sich integriert (auf einen Blick)</h2>
    <div class="diagram">Benutzer tippt → Telefon öffnet NDEF url_base
   → Frontend erfasst SDM-Parameter (PICC/CMAC)
   → Netlify-Funktion /nfc-unified/verify
   → SUN/CMAC-Verifizierung über Netlify-Funktion (Hardware-Bridge erzwungen, wenn konfiguriert)
   → Sitzungs-/Auth-Erfolg
   → (Optional) LNbits Boltcards nur für Wallet-/Registry-Metadaten verwendet
    </div>

    <h2>6) Fehlerbehebung</h2>
    <ul>
      <li><strong>Schreiben fehlgeschlagen / Tag verschoben</strong>: Halten Sie den Tag vollständig still; versuchen Sie es erneut. Stellen Sie sicher, dass die NFC-Spule des Telefons mit der Tag-Antenne ausgerichtet ist.</li>
      <li><strong>CMAC fehlt in der URL</strong>: SDM nicht aktiviert oder Offsets falsch. Wenden Sie die SDM-Konfiguration pro Blob erneut an.</li>
      <li><strong>Kann nicht neu programmiert werden</strong>: Schlüssel geändert, aber verloren. Der Tag kann ohne korrekte Schlüssel nicht neu bereitgestellt werden.</li>
      <li><strong>Desktop-Reader-Probleme</strong>: Verwenden Sie PN532 oder einen NXP-Reader mit NTAG424-Unterstützung; vermeiden Sie ältere ACR122U.</li>
      <li><strong>Android-Fehler</strong>: App neu installieren; stellen Sie sicher, dass NFC auf dem Gerät aktiviert ist und keine andere NFC-App Störungen verursacht.</li>
    </ul>

    <h2>7) Best Practices</h2>
    <ul>
      <li>Stellen Sie in einer kontrollierten Umgebung bereit (keine unbekannten NFC-Geräte in der Nähe).</li>
      <li>Speichern Sie den Provisioning-Blob in einem Passwort-Manager; senden Sie ihn niemals per E-Mail oder Chat.</li>
      <li>Testen Sie zunächst mit einem Ersatz-Tag; notieren Sie Erfolgs-Logs von <code>/nfc-unified/verify</code>.</li>
    </ul>

    <h2>8) Zusätzliche Ressourcen</h2>
    <div class="card">
      <p><strong>Dokumentation & Tools</strong></p>
      <ul>
        <li><a href="/docs/NFC_TROUBLESHOOTING.md" target="_blank" rel="noopener noreferrer">Fehlerbehebungshandbuch</a> - Häufige Probleme und Lösungen</li>
        <li><a href="/docs/NFC_API_ENDPOINTS.md" target="_blank" rel="noopener noreferrer">API-Referenz</a> - Vollständige Endpunkt-Dokumentation</li>
        <li><a href="/docs/NFC_SECURITY_ARCHITECTURE.md" target="_blank" rel="noopener noreferrer">Sicherheitsarchitektur</a> - Verschlüsselungsstandards und RLS-Richtlinien</li>
        <li><a href="/docs/NFC_FEATURE_FLAGS.md" target="_blank" rel="noopener noreferrer">Feature-Flags-Handbuch</a> - Konfiguration und Umgebungseinrichtung</li>
        <li><a href="/docs/ntag424-blob-viewer.html" target="_blank" rel="noopener noreferrer">Blob-Viewer-Tool</a> - Inspizieren Sie Card-Dateiinhalte</li>
      </ul>
    </div>

    <div class="callout ok" style="margin-top:12px">
      <strong>Produktionsstatus</strong>: Dieses Handbuch spiegelt die Phase-6-Fertigstellung mit 74 bestandenen Tests (36 Unit + 19 Integration + 19 E2E) wider. Alle Sicherheitsstandards verifiziert. Zero-Knowledge-Architektur bestätigt. Bereit für die Produktionsbereitstellung.
    </div>

    <p class="no-print" style="margin-top:24px;color:var(--muted)">Tipp: Verwenden Sie Ihren Browser-Druck → "Als PDF speichern", um dieses Handbuch zu exportieren.</p>
  </div>
</body>
</html>
