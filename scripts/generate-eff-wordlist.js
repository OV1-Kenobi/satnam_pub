/**
 * Script to generate the EFF wordlist TypeScript file
 * Run: node scripts/generate-eff-wordlist.js
 */

import fs from "fs";
import https from "https";
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const EFF_URL = "https://www.eff.org/files/2016/07/18/eff_large_wordlist.txt";
const OUTPUT_PATH = path.join(
  __dirname,
  "../src/lib/onboarding/eff-wordlist.ts",
);

function fetchWordlist() {
  return new Promise((resolve, reject) => {
    https
      .get(EFF_URL, (res) => {
        let data = "";
        res.on("data", (chunk) => (data += chunk));
        res.on("end", () => resolve(data));
        res.on("error", reject);
      })
      .on("error", reject);
  });
}

async function main() {
  console.log("Fetching EFF wordlist...");
  const rawData = await fetchWordlist();

  // Parse: each line is "diceCode\tword"
  const words = rawData
    .trim()
    .split("\n")
    .map((line) => line.split("\t")[1])
    .filter(Boolean);

  console.log(`Parsed ${words.length} words`);

  if (words.length !== 7776) {
    throw new Error(`Expected 7776 words, got ${words.length}`);
  }

  // Generate TypeScript file
  const tsContent = `/**
 * EFF Long Wordlist for Passphrase Generation
 * 
 * Source: https://www.eff.org/files/2016/07/18/eff_large_wordlist.txt
 * Generated by: scripts/generate-eff-wordlist.js
 * 
 * This wordlist contains 7776 words (6^5 = 7776 possible dice rolls).
 * Each word provides log2(7776) ≈ 12.925 bits of entropy.
 * 
 * For password phrase generation:
 * - 4 words: ~51.7 bits of entropy
 * - 5 words: ~64.6 bits of entropy
 */

export const EFF_WORDLIST: readonly string[] = [
${words.map((w) => `  "${w}",`).join("\n")}
] as const;

/** Total number of words in the EFF wordlist */
export const WORDLIST_SIZE = 7776;

/** Entropy bits per word: log2(7776) ≈ 12.925 bits */
export const ENTROPY_BITS_PER_WORD = 12.925;
`;

  fs.writeFileSync(OUTPUT_PATH, tsContent, "utf8");
  console.log(`Generated ${OUTPUT_PATH}`);
  console.log(
    `File size: ${(fs.statSync(OUTPUT_PATH).size / 1024).toFixed(1)} KB`,
  );
}

main().catch((err) => {
  console.error("Error:", err.message);
  process.exit(1);
});
